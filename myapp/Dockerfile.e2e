FROM mcr.microsoft.com/playwright:v1.58.0-jammy

WORKDIR /app

# ---------- 1) 安装 root 依赖（主要是 @playwright/test） ----------
COPY package.json package-lock.json* ./
RUN npm ci

# ---------- 2) 安装 backend 依赖 ----------
COPY myapp/backend/package.json myapp/backend/package-lock.json* ./myapp/backend/
RUN cd myapp/backend && npm ci

# ---------- 3) 拷贝剩余代码 ----------
COPY . .

# 默认运行 E2E
CMD ["npx", "playwright", "test"]
